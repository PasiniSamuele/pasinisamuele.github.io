<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Cycle and ECycle GAN | Samuele Pasini </title> <meta name="author" content="Samuele Pasini"> <meta name="description" content="Generative Adversarial Networks for Image-to-Image translation"> <meta name="keywords" content="deep-learning, computer-vision, nlp, llm"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon_1.svg?9a3b97ebf28cb15c27a88cdaab2d00d4"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://pasinisamuele.github.io/blog/2022/cycle/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?bf50d6d9dd867d3e0f3b0add94449649"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Cycle and ECycle GAN",
            "description": "Generative Adversarial Networks for Image-to-Image translation",
            "published": "November 27, 2022",
            "authors": [
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Samuele </span> Pasini </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">Publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">Projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">Blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Cycle and ECycle GAN</h1> <p>Generative Adversarial Networks for Image-to-Image translation</p> </d-title> <d-article> <p>Generative adversarial network (GAN) is a class of machine learning frameworks designed by Goodfellow et al. <d-cite key="GAN"></d-cite>. Two neural networks compete with each other. In particular, a discriminator and a generator are trained at the same time, competing in a sort of two players’ adversarial game. The Generator receives an input that belongs to a certain data distribution and produces a new sample that should belong to a target distribution. On the other hand, the Discriminator is fed with a sample that may or may not be produced by the generator and outputs the probability of the sample being real (not generated) or fake (generated).</p> <p>The goal of the generator is to fool the discriminator, producing realistic images belonging to the target domain, while the goal of the discriminator is to find a way to distinguish between real and fake samples.</p> <p>Traditionally, the input of the generator is sampled from a known distribution and it is referred to as noise. In case the input of the generator is an image of a specific (source) domain, that should be transformed into an image of a different (target) domain, the addressed task is <b>Image-to-Image translation</b> <d-cite key="im2im"></d-cite>.</p> <p>In particular, the aim is to learn the mapping between an input image and an output image, by using a training set of aligned image pairs. This could be useful for instance to perform style transfer, season transfer, and photo enhancement.</p> <p>Recently, different works have been developed to solve this task. For instance, Isola et al. <d-cite key="pix2pix"></d-cite> proposed Pix2Pix, a conditional adversarial network that learns the mapping from the input images to output images. However, training this network requires paired input-output images.</p> <p>Therefore, Zhu et al. <d-cite key="Zhu2017"></d-cite> proposed CycleGAN, a new architecture that learns to translate an image from a source domain \(X\) to a target domain \(Y\) in the absence of paired samples.</p> <p>CycleGAN makes use of two couples of GAN where each couple can transform images from one domain to the other. The goal is to learn a mapping \(G : X \rightarrow Y\) such that the distribution of generated images \(G(X)\) is indistinguishable from the distribution of images belonging to domain \(Y\). At the same time, this should hold also for the other domain. However, there are countless mappings between the two domains. For this reason, the authors introduced the cycle consistency loss to enforce that \(F(G(X)) \approx X\) and \(G(F(Y)) \approx Y\). This means that given an image \(x\) belonging to domain \(X\), that is transformed by \(G\) into an image \(\tilde{x}\) belonging to domain \(Y\), when \(\tilde{x}\) is transformed by \(F\) the output should be \(x\).</p> <p>An additional constraint is added since the authors show that it can provide better quality solutions. This constraint is called identity constraint and it enforces that \(F(X) \approx X\) and \(G(Y) \approx Y\). This means that the architecture should not modify an image if it already belongs to the target domain. To accomplish this task, the loss function is composed of multiple terms. First of all, as usual, the GANs are trained using an <b>adversarial loss</b> <d-cite key="GAN"></d-cite> . However, the original loss is replaced with a least square loss <d-cite key="LSGAN"></d-cite> since it ensures more stable training and higher quality results. Thus, the objective function to train the generator \(G : X \rightarrow Y\) and its corresponding discriminator \(D_{Y}\) is:</p> \[\displaylines{ \mathcal{L}_{\text{LSGAN}}[G,\ D_{Y}](X,\ Y)=\mathbb{E}_{y\sim p_{\text{data}}(Y)}[(D_{Y}(y)-1)^{2}] \\ +\mathbb{E}_{x\sim p_{\text{data}}(X)}[D_{Y}(G(x))^{2}] }\] <p>Another important term is the <b>cycle consistency loss</b> used to ensure both forward cycle-consistency, i.e., \(x \rightarrow G(x) \rightarrow F(G(x)) \approx x\), and backward cycle-consistency, i.e., \(y \rightarrow F(y) \rightarrow G(F(y)) \approx y\). This is done in a pixel-wise manner and is expressed as:</p> \[\label{eq:pixel-cyc} \displaylines{ \mathcal{L}_{pixel-cyc}[G, F](X,\ Y)=\mathbb{E}_{x\sim P_{\text{data}}(X)}[\lVert F(G(x)) - x \rVert_1 ] + \\ + \mathbb{E}_{y\sim P_{\text{data}}(Y)}[\lVert G(F(y)) - y \rVert_1 ] }\] <p>Finally, the last term to be considered is the <b>identity loss</b> used to ensure the identity constraints for both the \(X\) and \(Y\) domains and expressed via the following pixel-wise computation:</p> \[\label{eq:pixel-idt} \displaylines{ \mathcal{L}_{pixel-idt}[G, F](X,\ Y) =\mathbb{E}_{x\sim P_{\text{data}}(X)}[\lVert F(x) - x \rVert_1 ] \\ +\mathbb{E}_{y\sim P_{\text{data}}(Y)}[\lVert G(y) - y \rVert_1 ] }\] <p>Thus, the overall loss function is given by a weighted sum of these three terms:</p> \[\label{eq:overall} \displaylines{ \mathcal{L}[G, F, D_{X}, D_{Y}](X,\ Y) = \mathcal{L}_{\text{LSGAN}}[G,\ D_{Y}](X,\ Y) \\ +\mathcal{L}_{\text{LSGAN}}[F,\ D_{X}](Y,\ X) \\ +\lambda_{cyc} \mathcal{L}_{pixel-cyc}[G, F](X,\ Y) \\ +\lambda_{idt} \mathcal{L}_{pixel-idt}[G, F](X,\ Y) }\] <p>Even though CycleGANs can produce quite impressive results, for the task of 2-domain translation, the details about texture and style are often accompanied by unpleasant artifacts as reported in <d-cite key="Zhang2020"></d-cite>. Thus, to improve the effectiveness of domain translation, and obtain more realistic images, Zhang et al. <d-cite key="Zhang2020"></d-cite> proposed to modify the architecture, leading to the definition of Enhanced CycleGANs (<b>ECycleGANs</b>).</p> <p>One of the improvements suggested in the paper is to avoid relying only on pixel-wise losses to ensure cycle consistency since this could result in perceptually unsatisfying solutions with overly smooth textures. Thus, a loss function that takes into consideration the perceptual similarity is employed.</p> <p>This perceptual loss function includes a term named feature loss that is the euclidean distance between the high-level abstract feature representation of a cycle reconstructed image \(F(G(x))\) and the original image \(x\). The feature representations are extracted using a pre-trained 19 layer VGG network <d-cite key="vgg"></d-cite>. \(\phi_{i,j}\) identifies the feature map obtained by the \(j-th\) convolution (after activation) before the \(i-th\) max-pooling layer. This term is defined as:</p> \[\label{eq:ecycle_feature} \displaylines{ \mathcal{L}_{feature-cyc}[G, F](X,\ Y) \\ = \mathbb{E}_{i,j,x\sim P_{\text{data}}(X)}&amp;[\phi_{i,j}(F(G(x))) - \phi_{i,j}(x) ] \\ +\mathbb{E}_{i,j,y\sim P_{\text{data}}(Y)}&amp;[\phi_{i,j}(G(F(y))) - \phi_{i,j}(y) ] }\] <p>The feature loss and the pixel-wise loss are combined into the perceptual loss that is used as cycle consistency loss, where \(\alpha\) and \(\beta\) are the coefficients to balance these loss terms.</p> \[\label{eq:ecycle_perceptual} \displaylines{ \mathcal{L}_{perc-cyc}[G, F](X,\ Y) &amp;= \alpha(\mathcal{L}_{feature-cyc}[G, F](X,\ Y) \\ &amp;+ \beta(\mathcal{L}_{pixel-cyc}[G, F](X,\ Y)) }\] <p>To further improve the quality of the images produced by CycleGAN, a major adjustment to the structure of the generator is conducted. More specifically, the original basic residual block used inside the generator architecture is replaced with a Residual Dense Normalization Block (RDNB), which consists of a multi-level residual network, dense connection <d-cite key="densenet"></d-cite>, and instance normalization layers <d-cite key="instanceNorm"></d-cite>. This modification is performed following the fact that more layers and connections can optimize the performance of neural networks. However, to prevent instability in training a very deep network, a scaling factor named <b>residual scaling</b> is used to scale down the residuals. Thus, the perceptual loss encourages the translated images to be more realistic, while the introduction of RDNB blocks allows to generate high-quality images.</p> <p>I proposed an interesting work regarding Face Expression Data Augmentation considering both Cycle and ECycleGAN. You can find more detail about this projects <a href="https://pasinisamuele.github.io/projects/face_da/">at this link</a>.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2022-11-27-cycle.bib"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Samuele Pasini. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>